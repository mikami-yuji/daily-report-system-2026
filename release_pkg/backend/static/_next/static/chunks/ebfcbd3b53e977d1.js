(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},18257,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(9165),l=e.i(78138),a=e.i(55436),i=e.i(46897),n=e.i(25652),d=e.i(37727);function c({searchTerm:e,setSearchTerm:s,selectedArea:r,setSelectedArea:l,selectedRank:c,setSelectedRank:x,isPriorityOnly:o,setIsPriorityOnly:m,areas:h,ranks:p}){return(0,t.jsx)("div",{className:"bg-white rounded border border-sf-border shadow-sm p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(a.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,t.jsx)("input",{type:"text",placeholder:"得意先、直送先...",value:e,onChange:e=>s(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent"}),e&&(0,t.jsx)("button",{onClick:()=>s(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors",title:"検索条件をクリア",children:(0,t.jsx)(d.X,{size:16})})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(i.MapPin,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,t.jsxs)("select",{value:r,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent appearance-none bg-white","aria-label":"エリアで絞り込み",children:[(0,t.jsx)("option",{value:"",children:"すべてのエリア"}),h.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(n.TrendingUp,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,t.jsxs)("select",{value:c,onChange:e=>x(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent appearance-none bg-white","aria-label":"ランクで絞り込み",children:[(0,t.jsx)("option",{value:"",children:"すべてのランク"}),p.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,t.jsx)("input",{type:"checkbox",checked:o,onChange:e=>m(e.target.checked),className:"w-4 h-4 text-sf-light-blue border-gray-300 rounded focus:ring-sf-light-blue"}),(0,t.jsx)("span",{className:"text-sm text-sf-text",children:"重点顧客のみ表示"})]})})]})})}var x=e.i(64659),o=e.i(63059);let m=(0,e.i(75254).default)("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]);var h=e.i(22016);function p({customers:e,loading:r,expandedRows:l,toggleRow:a,emptyMessage:i}){return r?(0,t.jsx)("div",{className:"p-8 text-center text-sf-text-weak",children:"読み込み中..."}):0===e.length?(0,t.jsx)("div",{className:"p-8 text-center text-sf-text-weak",children:i||"得意先が見つかりません"}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"text-xs text-sf-text-weak bg-gray-50 border-b border-sf-border",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-medium w-8"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"得意先CD/直送先CD"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"得意先名/直送先名"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"エリア"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"ランク"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"重点"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"総活動数"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"訪問"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"電話"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"デザイン案件"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"最終活動日"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>(0,t.jsxs)(s.Fragment,{children:[(0,t.jsxs)("tr",{className:"border-b border-sf-border hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.subItems&&e.subItems.length>0&&(0,t.jsx)("button",{onClick:()=>a(e.id),className:"p-1 hover:bg-gray-200 rounded","aria-label":l.has(e.id)?"直送先を折りたたむ":"直送先を展開する",title:l.has(e.id)?"直送先を折りたたむ":"直送先を展開する",children:l.has(e.id)?(0,t.jsx)(x.ChevronDown,{size:16,className:"text-gray-500"}):(0,t.jsx)(o.ChevronRight,{size:16,className:"text-gray-500"})})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sf-text font-mono",children:e.code}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(h.default,{href:`/customers/detail?code=${e.code}`,className:"font-medium text-sf-light-blue hover:underline",children:e.name})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sf-text",children:e.area||"-"}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.rank&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:e.rank})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.isPriority&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"重点"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center font-semibold text-sf-text",children:e.totalActivities}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-green-600",children:e.visits}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-blue-600",children:e.calls}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.designRequests>0?(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:e.designRequests}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sf-text",children:e.lastActivity})]}),l.has(e.id)&&e.subItems?.map(e=>(0,t.jsxs)("tr",{className:"bg-sf-bg-light border-b border-sf-border hover:bg-gray-100",children:[(0,t.jsx)("td",{className:"px-4 py-3"}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sf-text-weak font-mono pl-8 text-xs flex items-center gap-1",children:[(0,t.jsx)(m,{size:12,className:"text-sf-text-weak"}),e.directDeliveryCode]}),(0,t.jsxs)("td",{className:"px-4 py-3 pl-8 text-sm",children:[(0,t.jsx)("span",{className:"text-sf-text-weak text-xs border border-gray-200 rounded px-1 mr-2 bg-white",children:"直送"}),e.directDeliveryName]}),(0,t.jsx)("td",{className:"px-4 py-3 text-sf-text-weak text-xs",children:e.area||"-"}),(0,t.jsx)("td",{className:"px-4 py-3 text-center"}),(0,t.jsx)("td",{className:"px-4 py-3 text-center"}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-xs text-sf-text-weak",children:e.totalActivities}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-xs text-green-600/70",children:e.visits}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-xs text-blue-600/70",children:e.calls}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.designRequests>0&&(0,t.jsx)("span",{className:"text-xs text-purple-800/70",children:e.designRequests})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sf-text-weak text-xs",children:e.lastActivity})]},e.id))]},e.id))})]})})}function u({customers:e,filteredCustomers:s}){return(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,t.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"総得意先数"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-sf-text",children:e.length})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,t.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"検索結果"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-sf-light-blue",children:s.length})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,t.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"重点顧客"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-yellow-600",children:e.filter(e=>e.isPriority).length})]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,t.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"総活動数"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-green-600",children:e.reduce((e,t)=>e+t.totalActivities,0)})]})]})}function f(){let{selectedFile:e}=(0,l.useFile)(),[a,i]=(0,s.useState)([]),[n,d]=(0,s.useState)([]),[x,o]=(0,s.useState)(!0),[m,h]=(0,s.useState)(""),[f,b]=(0,s.useState)(""),[g,y]=(0,s.useState)(""),[j,N]=(0,s.useState)(!1),[v,w]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{e&&(o(!0),(0,r.getReports)(e).then(e=>{let t,s,r=(t=new Map,s=(e,t,s,r,l,a=!1,i="",n="")=>({id:a?`${e}-${i}`:e,code:e,name:t,area:s,totalActivities:0,visits:0,calls:0,designRequests:0,isPriority:l,lastActivity:"",rank:r,isDirectDelivery:a,directDeliveryCode:i,directDeliveryName:n,subItems:a?void 0:[]}),e.forEach(e=>{let r=String(e.得意先CD||""),l=String(e.訪問先名||"").split("　")[0];if(!r)return;t.has(r)||t.set(r,s(r,l,String(e.エリア||""),String(e.ランク||""),!!(e.重点顧客&&"-"!==e.重点顧客&&""!==e.重点顧客)));let a=t.get(r),i=e.直送先CD?String(e.直送先CD):"",n=e.直送先名?String(e.直送先名):"",d=a;if(i){let t=a.subItems?.find(e=>e.directDeliveryCode===i);t||(t=s(r,l,String(e.エリア||""),String(e.ランク||""),!1,!0,i,n),a.subItems?.push(t)),d=t}d.totalActivities++,e.行動内容&&e.行動内容.includes("訪問")&&d.visits++,e.行動内容&&e.行動内容.includes("電話")&&d.calls++,e["システム確認用デザインNo."]&&!isNaN(Number(e["システム確認用デザインNo."]))&&d.designRequests++;let c=String(e.日付||"");(!d.lastActivity||c>d.lastActivity)&&(d.lastActivity=c),d!==a&&(a.totalActivities++,e.行動内容&&e.行動内容.includes("訪問")&&a.visits++,e.行動内容&&e.行動内容.includes("電話")&&a.calls++,e["システム確認用デザインNo."]&&!isNaN(Number(e["システム確認用デザインNo."]))&&a.designRequests++,(!a.lastActivity||c>a.lastActivity)&&(a.lastActivity=c))}),Array.from(t.values()).sort((e,t)=>t.totalActivities-e.totalActivities));i(r),d(r),o(!1)}).catch(e=>{console.error(e),o(!1)}))},[e]),(0,s.useEffect)(()=>{let e=a;if(m.trim()||f||g||j){let t=m.toLowerCase().trim(),s=new Set,r=e=>{let s=e.name.toLowerCase().includes(t),r=e.code.toLowerCase().includes(t),l=e.directDeliveryName?.toLowerCase().includes(t),a=e.directDeliveryCode?.toLowerCase().includes(t);return s||r||l||a};e=e.map(e=>{if(f&&e.area!==f||g&&e.rank!==g||j&&!e.isPriority)return null;let l=!t||r(e),a=e.subItems||[];if(t&&(a=a.filter(e=>r(e))),l||a.length>0)return t&&a.length>0&&(s.add(e.id),!l)?{...e,subItems:a}:l?{...e}:{...e,subItems:a};return null}).filter(e=>null!==e),t&&w(s)}d(e)},[m,f,g,j,a]);let k=Array.from(new Set(a.map(e=>e.area).filter(Boolean))).sort(),C=Array.from(new Set(a.map(e=>e.rank).filter(Boolean))).sort();return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-2xl font-semibold text-sf-text",children:"得意先一覧"})}),(0,t.jsx)(c,{searchTerm:m,setSearchTerm:h,selectedArea:f,setSelectedArea:b,selectedRank:g,setSelectedRank:y,isPriorityOnly:j,setIsPriorityOnly:N,areas:k,ranks:C}),(0,t.jsx)(u,{customers:a,filteredCustomers:n}),(0,t.jsxs)("div",{className:"bg-white rounded border border-sf-border shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-sf-border bg-gray-50",children:(0,t.jsx)("h2",{className:"font-semibold text-sm text-sf-text",children:"得意先一覧"})}),(0,t.jsx)(p,{customers:n,loading:x,expandedRows:v,toggleRow:e=>{let t=new Set(v);t.has(e)?t.delete(e):t.add(e),w(t)}})]})]})}e.s(["default",()=>f],18257)}]);