(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54928,e=>{"use strict";let t;var s=e.i(75555),r=e.i(40143),i=e.i(86491),n=e.i(15823),a=e.i(93803),l=e.i(19273),o=e.i(80166),d=class extends n.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#s=(0,a.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#r=void 0;#i=void 0;#n=void 0;#a;#l;#s;#t;#o;#d;#u;#c;#h;#p;#x=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#r.addObserver(this),u(this.#r,this.options)?this.#f():this.updateResult(),this.#g())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return c(this.#r,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return c(this.#r,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#m(),this.#b(),this.#r.removeObserver(this)}setOptions(e){let t=this.options,s=this.#r;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,l.resolveEnabled)(this.options.enabled,this.#r))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#v(),this.#r.setOptions(this.options),t._defaulted&&!(0,l.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#r,observer:this});let r=this.hasListeners();r&&h(this.#r,s,this.options,t)&&this.#f(),this.updateResult(),r&&(this.#r!==s||(0,l.resolveEnabled)(this.options.enabled,this.#r)!==(0,l.resolveEnabled)(t.enabled,this.#r)||(0,l.resolveStaleTime)(this.options.staleTime,this.#r)!==(0,l.resolveStaleTime)(t.staleTime,this.#r))&&this.#y();let i=this.#j();r&&(this.#r!==s||(0,l.resolveEnabled)(this.options.enabled,this.#r)!==(0,l.resolveEnabled)(t.enabled,this.#r)||i!==this.#p)&&this.#w(i)}getOptimisticResult(e){var t,s;let r=this.#e.getQueryCache().build(this.#e,e),i=this.createResult(r,e);return t=this,s=i,(0,l.shallowEqualObjects)(t.getCurrentResult(),s)||(this.#n=i,this.#l=this.options,this.#a=this.#r.state),i}getCurrentResult(){return this.#n}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),t?.(s),"promise"===s&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#s.status||this.#s.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,s))})}trackProp(e){this.#x.add(e)}getCurrentQuery(){return this.#r}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#f({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#f(e){this.#v();let t=this.#r.fetch(this.options,e);return e?.throwOnError||(t=t.catch(l.noop)),t}#y(){this.#m();let e=(0,l.resolveStaleTime)(this.options.staleTime,this.#r);if(l.isServer||this.#n.isStale||!(0,l.isValidTimeout)(e))return;let t=(0,l.timeUntilStale)(this.#n.dataUpdatedAt,e);this.#c=o.timeoutManager.setTimeout(()=>{this.#n.isStale||this.updateResult()},t+1)}#j(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#r):this.options.refetchInterval)??!1}#w(e){this.#b(),this.#p=e,!l.isServer&&!1!==(0,l.resolveEnabled)(this.options.enabled,this.#r)&&(0,l.isValidTimeout)(this.#p)&&0!==this.#p&&(this.#h=o.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||s.focusManager.isFocused())&&this.#f()},this.#p))}#g(){this.#y(),this.#w(this.#j())}#m(){this.#c&&(o.timeoutManager.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#h&&(o.timeoutManager.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){let s,r=this.#r,n=this.options,o=this.#n,d=this.#a,c=this.#l,x=e!==r?e.state:this.#i,{state:f}=e,g={...f},m=!1;if(t._optimisticResults){let s=this.hasListeners(),a=!s&&u(e,t),l=s&&h(e,r,t,n);(a||l)&&(g={...g,...(0,i.fetchState)(f.data,e.options)}),"isRestoring"===t._optimisticResults&&(g.fetchStatus="idle")}let{error:b,errorUpdatedAt:v,status:y}=g;s=g.data;let j=!1;if(void 0!==t.placeholderData&&void 0===s&&"pending"===y){let e;o?.isPlaceholderData&&t.placeholderData===c?.placeholderData?(e=o.data,j=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,void 0!==e&&(y="success",s=(0,l.replaceData)(o?.data,e,t),m=!0)}if(t.select&&void 0!==s&&!j)if(o&&s===d?.data&&t.select===this.#o)s=this.#d;else try{this.#o=t.select,s=t.select(s),s=(0,l.replaceData)(o?.data,s,t),this.#d=s,this.#t=null}catch(e){this.#t=e}this.#t&&(b=this.#t,s=this.#d,v=Date.now(),y="error");let w="fetching"===g.fetchStatus,N="pending"===y,C="error"===y,R=N&&w,S=void 0!==s,k={status:y,fetchStatus:g.fetchStatus,isPending:N,isSuccess:"success"===y,isError:C,isInitialLoading:R,isLoading:R,data:s,dataUpdatedAt:g.dataUpdatedAt,error:b,errorUpdatedAt:v,failureCount:g.fetchFailureCount,failureReason:g.fetchFailureReason,errorUpdateCount:g.errorUpdateCount,isFetched:g.dataUpdateCount>0||g.errorUpdateCount>0,isFetchedAfterMount:g.dataUpdateCount>x.dataUpdateCount||g.errorUpdateCount>x.errorUpdateCount,isFetching:w,isRefetching:w&&!N,isLoadingError:C&&!S,isPaused:"paused"===g.fetchStatus,isPlaceholderData:m,isRefetchError:C&&S,isStale:p(e,t),refetch:this.refetch,promise:this.#s,isEnabled:!1!==(0,l.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=e=>{"error"===k.status?e.reject(k.error):void 0!==k.data&&e.resolve(k.data)},s=()=>{t(this.#s=k.promise=(0,a.pendingThenable)())},i=this.#s;switch(i.status){case"pending":e.queryHash===r.queryHash&&t(i);break;case"fulfilled":("error"===k.status||k.data!==i.value)&&s();break;case"rejected":("error"!==k.status||k.error!==i.reason)&&s()}}return k}updateResult(){let e=this.#n,t=this.createResult(this.#r,this.options);if(this.#a=this.#r.state,this.#l=this.options,void 0!==this.#a.data&&(this.#u=this.#r),(0,l.shallowEqualObjects)(t,e))return;this.#n=t;let s=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#x.size)return!0;let r=new Set(s??this.#x);return this.options.throwOnError&&r.add("error"),Object.keys(this.#n).some(t=>this.#n[t]!==e[t]&&r.has(t))};this.#N({listeners:s()})}#v(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#r)return;let t=this.#r;this.#r=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#g()}#N(e){r.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#r,type:"observerResultsUpdated"})})}};function u(e,t){return!1!==(0,l.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&c(e,t,t.refetchOnMount)}function c(e,t,s){if(!1!==(0,l.resolveEnabled)(t.enabled,e)&&"static"!==(0,l.resolveStaleTime)(t.staleTime,e)){let r="function"==typeof s?s(e):s;return"always"===r||!1!==r&&p(e,t)}return!1}function h(e,t,s,r){return(e!==t||!1===(0,l.resolveEnabled)(r.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&p(e,s)}function p(e,t){return!1!==(0,l.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,l.resolveStaleTime)(t.staleTime,e))}e.i(47167);var x=e.i(71645),f=e.i(12598);e.i(43476);var g=x.createContext((t=!1,{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t})),m=x.createContext(!1);m.Provider;var b=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function v(e,t){return function(e,t,s){let i=x.useContext(m),n=x.useContext(g),a=(0,f.useQueryClient)(s),o=a.defaultQueryOptions(e);if(a.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=i?"isRestoring":"optimistic",o.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=o.staleTime;o.staleTime="function"==typeof t?(...s)=>e(t(...s)):e(t),"number"==typeof o.gcTime&&(o.gcTime=Math.max(o.gcTime,1e3))}(o.suspense||o.throwOnError||o.experimental_prefetchInRender)&&!n.isReset()&&(o.retryOnMount=!1),x.useEffect(()=>{n.clearReset()},[n]);let d=!a.getQueryCache().get(o.queryHash),[u]=x.useState(()=>new t(a,o)),c=u.getOptimisticResult(o),h=!i&&!1!==e.subscribed;if(x.useSyncExternalStore(x.useCallback(e=>{let t=h?u.subscribe(r.notifyManager.batchCalls(e)):l.noop;return u.updateResult(),t},[u,h]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),x.useEffect(()=>{u.setOptions(o)},[o,u]),o?.suspense&&c.isPending)throw b(o,u,n);if((({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&void 0===e.data||(0,l.shouldThrowError)(s,[e.error,r])))({result:c,errorResetBoundary:n,throwOnError:o.throwOnError,query:a.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw c.error;if(a.getDefaultOptions().queries?._experimental_afterQuery?.(o,c),o.experimental_prefetchInRender&&!l.isServer&&c.isLoading&&c.isFetching&&!i){let e=d?b(o,u,n):a.getQueryCache().get(o.queryHash)?.promise;e?.catch(l.noop).finally(()=>{u.updateResult()})}return o.notifyOnChangeProps?c:u.trackResult(c)}(e,d,t)}e.i(14272),n.Subscribable,e.i(78138);var y=e.i(9165);e.i(5766);let j={reports:e=>["reports",e],files:["files"],customers:e=>["customers",e],sales:["sales"]};function w(e){return v({queryKey:j.reports(e),queryFn:()=>(0,y.getReports)(e),enabled:!!e})}function N(){return v({queryKey:j.files,queryFn:y.getFiles})}function C(e){return v({queryKey:j.customers(e),queryFn:()=>(0,y.getCustomers)(e),enabled:!!e})}function R(){return v({queryKey:j.sales,queryFn:y.getAllSales})}e.s(["queryKeys",0,j,"useCustomers",()=>C,"useFiles",()=>N,"useReports",()=>w,"useSales",()=>R],54928)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},55900,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],55900)},7233,27612,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],7233);let r=(0,t.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>r],27612)},93450,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(78138),i=e.i(9165),n=e.i(54928),a=e.i(12598),l=e.i(7233),o=e.i(27612);let d=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var u=e.i(87316),c=e.i(7486),h=e.i(64659),p=e.i(55900),x=e.i(55436),f=e.i(63209),g=e.i(22016),m=e.i(5766);let b=()=>({id:crypto.randomUUID(),得意先CD:"",訪問先名:"",直送先CD:"",直送先名:"",行動内容:"",面談者:"",滞在時間:"",商談内容:"",提案物:"",次回プラン:"",競合他社情報:"",エリア:"",ランク:"",重点顧客:"",デザイン提案有無:"",デザイン種別:"",デザイン名:"",デザイン進捗状況:"","デザイン依頼No.":"",designMode:"none",designs:[],isExpanded:!0,outingStartTime:"",outingEndTime:"",interviewers:[],currentTarget:""});function v(){let{selectedFile:e}=(0,r.useFile)(),v=(0,a.useQueryClient)(),y=(0,s.useMemo)(()=>{let e=[];for(let t=8;t<=22;t++)for(let s=0;s<60&&(22!==t||!(s>0));s+=30){let r=t.toString().padStart(2,"0"),i=s.toString().padStart(2,"0");e.push(`${r}:${i}`)}return e},[]),j=new Date().toISOString().split("T")[0].replace(/-/g,"/").slice(2),[w,N]=(0,s.useState)(j),{data:C=[]}=(0,n.useReports)(e),[R,S]=(0,s.useState)([]),[k,T]=(0,s.useState)(!1);(0,s.useEffect)(()=>{k||(S([b()]),T(!0))},[k]);let[D,Q]=(0,s.useState)([]),[E,I]=(0,s.useState)([]),[O,M]=(0,s.useState)(!1),[F,q]=(0,s.useState)({}),[$,z]=(0,s.useState)(!1),[U,P]=(0,s.useState)({}),[L,_]=(0,s.useState)({}),[A,B]=(0,s.useState)({}),[K,H]=(0,s.useState)({}),V=(0,s.useMemo)(()=>{let e=new Set;return C.filter(e=>"量販店調査"===e.行動内容&&e.訪問先名).forEach(t=>e.add(String(t.訪問先名))),Array.from(e).sort()},[C]);(0,s.useEffect)(()=>{e&&(0,i.getCustomers)(e).then(Q).catch(console.error)},[e]);let W=["-","訪問（アポあり）","訪問（アポなし）","訪問（新規）","訪問（クレーム）","電話商談","電話アポ取り","メール商談","量販店調査","社内（半日）","社内（１日）","外出時間","その他"],Y=(e,t,s)=>{S(r=>r.map(r=>r.id===e?{...r,[t]:s}:r))},G=(e,t)=>{S(s=>s.map(s=>s.id!==e?s:"none"===t?{...s,designMode:"none",デザイン提案有無:"",デザイン種別:"",デザイン名:"",デザイン進捗状況:"","デザイン依頼No.":""}:"new"===t?{...s,designMode:"new",デザイン提案有無:"あり",デザイン進捗状況:"新規"}:{...s,designMode:"existing",デザイン提案有無:"あり"}))},J=e=>{if(!e.trim())return[];let t=e.toLowerCase();return D.filter(e=>e.得意先CD&&String(e.得意先CD).toLowerCase().includes(t)||e.得意先名&&String(e.得意先名).toLowerCase().includes(t)||e.フリガナ&&String(e.フリガナ).toLowerCase().includes(t)||e.直送先名&&String(e.直送先名).toLowerCase().includes(t)).slice(0,10)},X=(0,s.useCallback)(()=>{let e={},t=!1;return R.forEach(s=>{let r={};["社内（半日）","社内（１日）","外出時間"].includes(s.行動内容)||s.得意先CD||(r.得意先CD="得意先を選択してください",t=!0),s.行動内容&&"-"!==s.行動内容||(r.行動内容="行動内容を選択してください",t=!0),"外出時間"!==s.行動内容||s.outingStartTime&&s.outingEndTime||(r.外出時間="外出時間の開始・終了時刻を入力してください",t=!0),Object.keys(r).length>0&&(e[s.id]=r)}),{isValid:!t,errors:e}},[R]),Z=async()=>{let{isValid:s,errors:r}=X();if(q(r),z(!0),!s){let e=Object.keys(r).length;m.default.error((0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.AlertCircle,{size:18}),(0,t.jsxs)("span",{children:[e,"件の入力エラーがあります。赤枠の項目を確認してください"]})]}),{duration:4e3});return}let a=R.filter(e=>(["社内（半日）","社内（１日）","外出時間"].includes(e.行動内容)||e.得意先CD)&&e.行動内容&&"-"!==e.行動内容);if(0===a.length)return void m.default.error("保存するデータがありません");M(!0);let l=0,o=0;for(let t of a){let s=t.商談内容||"",r=t.ランク;if("外出時間"===t.行動内容){let e="";t.outingStartTime&&t.outingEndTime&&(e+=`【外出時間】${t.outingStartTime}〜${t.outingEndTime}
`),t.ランク&&(e+=`【満足度】${t.ランク}
`),s=e+s,r=""}let n={日付:w,得意先CD:t.得意先CD,訪問先名:t.訪問先名,直送先CD:t.直送先CD,直送先名:t.直送先名,行動内容:t.行動内容,面談者:t.面談者,滞在時間:t.滞在時間,商談内容:s,提案物:t.提案物,次回プラン:t.次回プラン,競合他社情報:t.競合他社情報,エリア:t.エリア,ランク:r,重点顧客:t.重点顧客,デザイン提案有無:t.デザイン提案有無,デザイン種別:t.デザイン種別,デザイン名:t.デザイン名,デザイン進捗状況:t.デザイン進捗状況,"デザイン依頼No.":t["デザイン依頼No."]};try{await (0,i.addReport)(n,e),l++}catch(e){console.error("Failed to create report:",e),o++}}M(!1),l>0&&(m.default.success(`${l}件の日報を保存しました`),v.invalidateQueries({queryKey:n.queryKeys.reports(e||void 0)}),S([b()])),o>0&&m.default.error(`${o}件の保存に失敗しました`)},ee=R.filter(e=>e.得意先CD&&e.行動内容).length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-sf-text",children:"日報一括入力"}),(0,t.jsx)("p",{className:"text-sm text-sf-text-weak mt-1",children:"複数の訪問先を一度に入力できます"})]}),(0,t.jsx)(g.default,{href:"/reports",className:"text-sm text-sf-light-blue hover:underline",children:"← 日報一覧に戻る"})]}),(0,t.jsx)("div",{className:"bg-white rounded border border-sf-border shadow-sm p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(u.Calendar,{size:20,className:"text-gray-400"}),(0,t.jsx)("label",{className:"text-sm font-medium text-sf-text",children:"日付"}),(0,t.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),placeholder:"YY/MM/DD",className:"px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent w-40"}),(0,t.jsx)("span",{className:"text-xs text-sf-text-weak",children:"※全ての訪問に適用されます"})]})}),(0,t.jsx)("div",{className:"space-y-4",children:R.map((s,r)=>(0,t.jsxs)("div",{className:"bg-white rounded border border-sf-border shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50 border-b border-sf-border cursor-pointer",onClick:()=>{var e;return e=s.id,void S(R.map(t=>t.id===e?{...t,isExpanded:!t.isExpanded}:t))},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("span",{className:"text-sm font-semibold text-sf-text",children:["訪問 #",r+1]}),s.訪問先名&&(0,t.jsxs)("span",{className:"text-sm text-sf-text-weak",children:["- ",s.訪問先名]}),s.行動内容&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded",children:s.行動内容})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[R.length>1&&(0,t.jsx)("button",{type:"button",onClick:e=>{var t;e.stopPropagation(),t=s.id,R.length<=1?m.default.error("最低1件の訪問が必要です"):S(R.filter(e=>e.id!==t))},className:"p-1 text-red-500 hover:bg-red-50 rounded",children:(0,t.jsx)(o.Trash2,{size:16})}),s.isExpanded?(0,t.jsx)(p.ChevronUp,{size:16}):(0,t.jsx)(h.ChevronDown,{size:16})]})]}),s.isExpanded&&(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[!["社内（半日）","社内（１日）","外出時間","量販店調査"].includes(s.行動内容)&&(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:["得意先CD / 訪問先名 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),s.得意先CD?(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 border border-sf-border rounded",children:[(0,t.jsx)(c.Building2,{size:16,className:"text-gray-400"}),(0,t.jsx)("span",{className:"font-mono text-sm",children:s.得意先CD}),(0,t.jsx)("span",{className:"text-sm text-sf-text",children:s.訪問先名}),(0,t.jsx)("button",{type:"button",onClick:()=>{Y(s.id,"得意先CD",""),F[s.id]?.得意先CD&&q(e=>{let t={...e};return t[s.id]&&(delete t[s.id].得意先CD,0===Object.keys(t[s.id]).length&&delete t[s.id]),t})},className:"ml-auto text-gray-400 hover:text-red-500",children:"×"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),(0,t.jsx)("input",{type:"text",value:U[s.id]||"",onChange:e=>{P({...U,[s.id]:e.target.value}),_({...L,[s.id]:!0})},onFocus:()=>_({...L,[s.id]:!0}),placeholder:"得意先CD、名前、カナで検索...",className:`w-full pl-9 pr-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent ${$&&F[s.id]?.得意先CD?"border-red-500 bg-red-50":"border-sf-border"}`})]}),$&&F[s.id]?.得意先CD&&(0,t.jsxs)("div",{className:"flex items-center gap-1 mt-1 text-red-500 text-xs",children:[(0,t.jsx)(f.AlertCircle,{size:12}),(0,t.jsx)("span",{children:F[s.id].得意先CD})]})]}),L[s.id]&&U[s.id]&&(0,t.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-sf-border rounded shadow-lg max-h-48 overflow-y-auto",children:[J(U[s.id]).map(r=>(0,t.jsxs)("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer text-sm",onClick:()=>{var t;let n;return t=s.id,n=r.直送先名?`${r.得意先名}　${r.直送先名}`:r.得意先名||"",void(S(e=>e.map(e=>e.id===t?{...e,得意先CD:r.得意先CD||"",訪問先名:n,直送先CD:r.直送先CD||"",直送先名:r.直送先名||"",エリア:r.エリア||"",ランク:r.ランク||"",重点顧客:r.重点顧客||"",designs:[],currentTarget:r["現目標"]||""}:e)),_({...L,[t]:!1}),P({...U,[t]:""}),r.得意先CD&&((0,i.getDesigns)(r.得意先CD,e,r.直送先名||void 0).then(e=>{S(s=>s.map(s=>s.id===t?{...s,designs:e}:s))}).catch(e=>{console.error("Failed to fetch designs:",e)}),(0,i.getInterviewers)(r.得意先CD,e,r.得意先名,r.直送先名).then(e=>{S(s=>s.map(s=>s.id===t?{...s,interviewers:e}:s))}).catch(e=>{console.error("Failed to fetch interviewers:",e)})))},children:[(0,t.jsx)("span",{className:"font-mono text-xs text-gray-500 mr-2",children:r.得意先CD}),r.直送先名?`${r.得意先名}　${r.直送先名}`:r.得意先名]},`${r.得意先CD}-${r.直送先CD||"main"}`)),0===J(U[s.id]).length&&(0,t.jsx)("div",{className:"px-3 py-2 text-sm text-gray-400",children:"該当する得意先がありません"})]})]})}),s.currentTarget&&(0,t.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-blue-100 to-indigo-100 border border-blue-300 rounded-lg",children:[(0,t.jsx)("span",{className:"text-xs font-bold text-blue-700 bg-blue-200 px-2 py-0.5 rounded",children:"目標"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-blue-900",children:s.currentTarget})]}),"量販店調査"===s.行動内容&&(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"訪問先名（店舗名）"}),(0,t.jsx)("input",{type:"text",value:A[s.id]||s.訪問先名||"",onChange:e=>{B({...A,[s.id]:e.target.value}),Y(s.id,"訪問先名",e.target.value),H({...K,[s.id]:!0})},onFocus:()=>H({...K,[s.id]:!0}),onBlur:()=>setTimeout(()=>H({...K,[s.id]:!1}),200),placeholder:"店舗名を入力（過去履歴から検索可）...",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent"}),K[s.id]&&(A[s.id]||s.訪問先名)&&(0,t.jsxs)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-sf-border rounded shadow-lg max-h-48 overflow-y-auto",children:[V.filter(e=>e.toLowerCase().includes((A[s.id]||s.訪問先名||"").toLowerCase())).slice(0,10).map(e=>(0,t.jsx)("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer text-sm",onMouseDown:()=>{Y(s.id,"訪問先名",e),B({...A,[s.id]:e}),H({...K,[s.id]:!1})},children:e},e)),0===V.filter(e=>e.toLowerCase().includes((A[s.id]||s.訪問先名||"").toLowerCase())).length&&(0,t.jsx)("div",{className:"px-3 py-2 text-sm text-gray-400",children:"新規入力（履歴なし）"})]})]})}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:["行動内容 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{value:s.行動内容,onChange:e=>{Y(s.id,"行動内容",e.target.value),F[s.id]?.行動内容&&q(e=>{let t={...e};return t[s.id]&&(delete t[s.id].行動内容,0===Object.keys(t[s.id]).length&&delete t[s.id]),t})},className:`w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent ${$&&F[s.id]?.行動内容?"border-red-500 bg-red-50":"border-sf-border"}`,children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),W.filter(e=>!s.得意先CD&&!s.訪問先名||!["社内（半日）","社内（１日）","外出時間"].includes(e)).map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),$&&F[s.id]?.行動内容&&(0,t.jsxs)("div",{className:"flex items-center gap-1 mt-1 text-red-500 text-xs",children:[(0,t.jsx)(f.AlertCircle,{size:12}),(0,t.jsx)("span",{children:F[s.id].行動内容})]})]})}),!["社内（１日）","社内（半日）","外出時間","量販店調査"].includes(s.行動内容)&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"面談者"}),(0,t.jsx)("input",{type:"text",value:s.面談者,onChange:e=>Y(s.id,"面談者",e.target.value),list:`interviewers-${s.id}`,placeholder:"氏名を入力または選択",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent"}),(0,t.jsx)("datalist",{id:`interviewers-${s.id}`,children:s.interviewers.map((e,s)=>(0,t.jsx)("option",{value:e},s))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"滞在時間"}),(0,t.jsxs)("select",{value:s.滞在時間,onChange:e=>Y(s.id,"滞在時間",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),(0,t.jsx)("option",{value:"-",children:"-"}),(0,t.jsx)("option",{value:"10分未満",children:"10分未満"}),(0,t.jsx)("option",{value:"30分未満",children:"30分未満"}),(0,t.jsx)("option",{value:"60分未満",children:"60分未満"}),(0,t.jsx)("option",{value:"60分以上",children:"60分以上"})]})]})]}),"外出時間"===s.行動内容&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"外出活動時間"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("select",{value:s.outingStartTime||"",onChange:e=>Y(s.id,"outingStartTime",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"開始時間"}),y.map(e=>(0,t.jsx)("option",{value:e,children:e},`start-${e}`))]}),(0,t.jsx)("span",{className:"text-gray-400",children:"～"}),(0,t.jsxs)("select",{value:s.outingEndTime||"",onChange:e=>Y(s.id,"outingEndTime",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"終了時間"}),y.filter(e=>!s.outingStartTime||e>s.outingStartTime).map(e=>(0,t.jsx)("option",{value:e,children:e},`end-${e}`))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"満足度（達成率）"}),(0,t.jsxs)("select",{value:s.ランク,onChange:e=>Y(s.id,"ランク",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),(0,t.jsx)("option",{value:"0%",children:"0%"}),(0,t.jsx)("option",{value:"25%",children:"25%"}),(0,t.jsx)("option",{value:"50%",children:"50%"}),(0,t.jsx)("option",{value:"75%",children:"75%"}),(0,t.jsx)("option",{value:"100%",children:"100%"})]})]})]}),["社内（１日）","社内（半日）","量販店調査","外出時間"].includes(s.行動内容)&&(0,t.jsx)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"商談内容・メモ"}),(0,t.jsx)("textarea",{value:s.商談内容,onChange:e=>Y(s.id,"商談内容",e.target.value),rows:3,onFocus:e=>e.currentTarget.rows=6,onBlur:e=>e.currentTarget.rows=3,placeholder:"商談内容やメモを入力（任意）...",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent resize-none transition-all"})]})}),!["社内（１日）","社内（半日）","量販店調査","外出時間"].includes(s.行動内容)&&(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-sf-text mb-3",children:"デザイン情報"}),(0,t.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:`designMode-${s.id}`,checked:"none"===s.designMode,onChange:()=>G(s.id,"none"),className:"text-sf-light-blue focus:ring-sf-light-blue"}),(0,t.jsx)("span",{children:"なし"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:`designMode-${s.id}`,checked:"new"===s.designMode,onChange:()=>G(s.id,"new"),className:"text-sf-light-blue focus:ring-sf-light-blue"}),(0,t.jsx)("span",{children:"新規"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",name:`designMode-${s.id}`,checked:"existing"===s.designMode,onChange:()=>G(s.id,"existing"),className:"text-sf-light-blue focus:ring-sf-light-blue"}),(0,t.jsx)("span",{children:"既存"})]})]}),"existing"===s.designMode&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"過去のデザイン案件"}),(0,t.jsxs)("select",{value:s["デザイン依頼No."],onChange:e=>{var t,r;return t=s.id,r=e.target.value,void S(e=>e.map(e=>{if(e.id!==t)return e;let s=e.designs.find(e=>String(e.デザイン依頼No)===r);return s?{...e,"デザイン依頼No.":String(s.デザイン依頼No),デザイン種別:s.デザイン種別||"",デザイン名:s.デザイン名||"",デザイン進捗状況:s.デザイン進捗状況||""}:e}))},className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),s.designs.map(e=>(0,t.jsxs)("option",{value:String(e.デザイン依頼No),children:[e.デザイン依頼No," - ",e.デザイン名," (",e.デザイン進捗状況,")"]},String(e.デザイン依頼No)))]}),0===s.designs.length&&s.得意先CD&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"この得意先のデザイン案件はありません"})]}),("new"===s.designMode||"existing"===s.designMode)&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"デザイン依頼No."}),(0,t.jsx)("input",{type:"text",value:s["デザイン依頼No."],onChange:e=>Y(s.id,"デザイン依頼No.",e.target.value),placeholder:"依頼番号",readOnly:"existing"===s.designMode,className:`w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent ${"existing"===s.designMode?"bg-gray-100":""}`})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"デザイン種別"}),"existing"===s.designMode?(0,t.jsx)("input",{type:"text",value:s.デザイン種別,readOnly:!0,className:"w-full px-3 py-2 border border-sf-border rounded bg-gray-100"}):(0,t.jsxs)("select",{value:s.デザイン種別,onChange:e=>Y(s.id,"デザイン種別",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),(0,t.jsx)("option",{value:"-",children:"-"}),(0,t.jsx)("option",{value:"別注（新版）",children:"別注（新版）"}),(0,t.jsx)("option",{value:"別注（改版）",children:"別注（改版）"}),(0,t.jsx)("option",{value:"別注（再版）",children:"別注（再版）"}),(0,t.jsx)("option",{value:"SP（新版）",children:"SP（新版）"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"デザイン名"}),(0,t.jsx)("input",{type:"text",value:s.デザイン名,onChange:e=>Y(s.id,"デザイン名",e.target.value),placeholder:"デザイン名を入力",readOnly:"existing"===s.designMode,className:`w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent ${"existing"===s.designMode?"bg-gray-100":""}`})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"デザイン進捗状況"}),(0,t.jsxs)("select",{value:s.デザイン進捗状況,onChange:e=>Y(s.id,"デザイン進捗状況",e.target.value),className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),(0,t.jsx)("option",{value:"-",children:"-"}),(0,t.jsx)("option",{value:"新規",children:"新規"}),(0,t.jsx)("option",{value:"50％未満",children:"50％未満"}),(0,t.jsx)("option",{value:"80％未満",children:"80％未満"}),(0,t.jsx)("option",{value:"80％以上",children:"80％以上"}),(0,t.jsx)("option",{value:"出稿",children:"出稿"}),(0,t.jsx)("option",{value:"不採用（コンペ負け）",children:"不採用（コンペ負け）"}),(0,t.jsx)("option",{value:"不採用（企画倒れ）",children:"不採用（企画倒れ）"}),(0,t.jsx)("option",{value:"保留",children:"保留"})]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"商談内容"}),(0,t.jsx)("textarea",{value:s.商談内容,onChange:e=>Y(s.id,"商談内容",e.target.value),rows:2,onFocus:e=>e.currentTarget.rows=6,onBlur:e=>e.currentTarget.rows=2,placeholder:"商談の内容を入力...",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent resize-none transition-all"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"提案物"}),(0,t.jsx)("textarea",{value:s.提案物,onChange:e=>Y(s.id,"提案物",e.target.value),rows:1,onFocus:e=>e.currentTarget.rows=4,onBlur:e=>e.currentTarget.rows=1,placeholder:"カタログ、サンプルなど",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent resize-none transition-all"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"次回プラン"}),(0,t.jsx)("textarea",{value:s.次回プラン,onChange:e=>Y(s.id,"次回プラン",e.target.value),rows:1,onFocus:e=>e.currentTarget.rows=4,onBlur:e=>e.currentTarget.rows=1,placeholder:"次回訪問予定など",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent resize-none transition-all"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-sf-text-weak mb-1",children:"競合他社情報"}),(0,t.jsx)("textarea",{value:s.競合他社情報,onChange:e=>Y(s.id,"競合他社情報",e.target.value),rows:1,onFocus:e=>e.currentTarget.rows=4,onBlur:e=>e.currentTarget.rows=1,placeholder:"競合他社の動向など",className:"w-full px-3 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent resize-none transition-all"})]})]})]})]},s.id))}),(0,t.jsxs)("button",{type:"button",onClick:()=>{S([...R,b()])},className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-sf-text-weak hover:border-sf-light-blue hover:text-sf-light-blue transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)(l.Plus,{size:20}),"訪問を追加"]}),(0,t.jsxs)("div",{className:"bg-white rounded border border-sf-border shadow-sm p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-sf-text-weak",children:["入力済み: ",(0,t.jsx)("span",{className:"font-semibold text-sf-text",children:ee})," 件"]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(g.default,{href:"/reports",className:"px-4 py-2 text-sf-text-weak hover:text-sf-text border border-sf-border rounded",children:"キャンセル"}),(0,t.jsxs)("button",{type:"button",onClick:Z,disabled:O||0===ee,className:"px-6 py-2 bg-sf-light-blue text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,t.jsx)(d,{size:18}),O?"保存中...":`一括保存 (${ee}件)`]})]})]})]})}e.s(["default",()=>v],93450)}]);