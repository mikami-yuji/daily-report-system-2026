(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let s=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>s],55436)},25652,e=>{"use strict";let s=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>s],25652)},84614,e=>{"use strict";let s=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],84614)},73708,e=>{"use strict";let s=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>s],73708)},47615,e=>{"use strict";let s=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>s],47615)},52008,e=>{"use strict";let s=(0,e.i(75254).default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);e.s(["Layers",()=>s],52008)},37727,e=>{"use strict";let s=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>s],37727)},64659,e=>{"use strict";let s=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>s],64659)},98444,e=>{"use strict";var s=e.i(43476),t=e.i(71645),r=e.i(9165),a=e.i(78138),l=e.i(55436),i=e.i(87316),d=e.i(84614),n=e.i(78583),c=e.i(64659);let o=(0,e.i(75254).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var x=e.i(88844),m=e.i(52008),h=e.i(25652),u=e.i(47615),g=e.i(73708),f=e.i(37727),p=e.i(22016),j=e.i(5766);function b(){let{selectedFile:e}=(0,a.useFile)(),[b,N]=(0,t.useState)([]),[y,v]=(0,t.useState)(!0),[w,k]=(0,t.useState)(""),[S,C]=(0,t.useState)(""),[z,q]=(0,t.useState)(""),[T,L]=(0,t.useState)(""),[P,A]=(0,t.useState)([]),[M,U]=(0,t.useState)([]),[E,F]=(0,t.useState)(new Set),[D,I]=(0,t.useState)([]),[R,$]=(0,t.useState)(!1),[B,H]=(0,t.useState)([]),[K,O]=(0,t.useState)(!1),[X,W]=(0,t.useState)(""),_=async(s,t)=>{if(t.stopPropagation(),s){$(!0),W(String(s));try{let t=await (0,r.searchDesignImages)(String(s),e||void 0);t.images&&t.images.length>0?(H(t.images),O(!0),j.default.success(`${t.images.length}件の画像が見つかりました`)):(j.default.error("画像が見つかりませんでした"),H([]))}catch(e){console.error("Search error:",e),j.default.error("画像検索中にエラーが発生しました")}finally{$(!1)}}};(0,t.useEffect)(()=>{e&&(v(!0),(0,r.getReports)(e).then(e=>{N(e);let s=G(e),t=new Map;s.forEach(e=>{e.customerCode&&e.customerName&&!t.has(e.customerCode)&&t.set(e.customerCode,e.customerName)});let r=Array.from(t.entries()).map(([e,s])=>({code:e,name:s})).sort((e,s)=>e.code.localeCompare(s.code));A(s),I(r),v(!1)}).catch(e=>{console.error(e),v(!1)}))},[e]);let G=e=>{let s=new Map;e.forEach(e=>{let t=e["システム確認用デザインNo."];if(t){let r=String(t).trim();s.has(r)||s.set(r,{designNo:r,customerCode:String(e.得意先CD||""),customerName:String(e.訪問先名||""),designProposal:String(e["デザイン提案有無"]||""),designType:String(e["デザイン種別"]||""),designName:String(e["デザイン名"]||""),designProgress:String(e["デザイン進捗状況"]||""),requests:[]}),s.get(r).requests.push(e)}});let t=Array.from(s.values()).map(e=>({...e,requests:e.requests.sort((e,s)=>{let t=String(e.日付||""),r=String(s.日付||"");return t.localeCompare(r)})}));return t.sort((e,s)=>{let t=e.requests[e.requests.length-1],r=s.requests[s.requests.length-1],a=t?.日付||"",l=(r?.日付||"").localeCompare(a);return 0!==l?l:String(s.designNo).localeCompare(String(e.designNo),void 0,{numeric:!0})}),t},J=(0,t.useMemo)(()=>{let e=P;S&&(e=e.filter(e=>e.customerCode===S));let s=new Set;return e.forEach(e=>{e.designType&&s.add(e.designType)}),Array.from(s).sort()},[P,S]),Q=(0,t.useMemo)(()=>{let e=P;S&&(e=e.filter(e=>e.customerCode===S)),z&&(e=e.filter(e=>e.designType===z));let s=new Set;return e.forEach(e=>{e.designProgress&&s.add(e.designProgress)}),Array.from(s).sort()},[P,S,z]);return(0,t.useEffect)(()=>{let e=P;if(S&&(e=e.filter(e=>e.customerCode===S)),z&&(e=e.filter(e=>e.designType===z)),T&&(e=e.filter(e=>e.designProgress===T)),w.trim()){let s=w.toLowerCase();e=e.filter(e=>String(e.designNo).includes(s)||e.customerCode.toLowerCase().includes(s)||e.customerName.toLowerCase().includes(s)||e.designName.toLowerCase().includes(s)||e.designType.toLowerCase().includes(s))}U(e)},[w,S,z,T,P]),(0,t.useEffect)(()=>{z&&!J.includes(z)&&q("")},[J,z]),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-2xl font-semibold text-sf-text",children:"デザイン依頼検索"})}),(0,s.jsx)("div",{className:"bg-white rounded border border-sf-border shadow-sm p-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(l.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,s.jsx)("input",{type:"text",placeholder:"デザインNo.、得意先、デザイン名、種別で検索...",value:w,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Filter,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,s.jsxs)("select",{value:S,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent appearance-none bg-white",children:[(0,s.jsx)("option",{value:"",children:"すべての得意先"}),D.map(e=>(0,s.jsxs)("option",{value:e.code,children:[e.code," - ",e.name]},e.code))]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.Layers,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,s.jsxs)("select",{value:z,onChange:e=>q(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent appearance-none bg-white",children:[(0,s.jsx)("option",{value:"",children:"すべての種別"}),J.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(h.TrendingUp,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,s.jsxs)("select",{value:T,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-sf-border rounded focus:outline-none focus:ring-2 focus:ring-sf-light-blue focus:border-transparent appearance-none bg-white",children:[(0,s.jsx)("option",{value:"",children:"すべての進捗状況"}),Q.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,s.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"総デザイン依頼数"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-sf-text",children:P.length})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,s.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"検索結果"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-sf-light-blue",children:M.length})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded border border-sf-border shadow-sm",children:[(0,s.jsx)("p",{className:"text-sm text-sf-text-weak mb-1",children:"総活動記録数"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-green-600",children:M.reduce((e,s)=>e+s.requests.length,0)})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded border border-sf-border shadow-sm overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-sf-border bg-gray-50",children:(0,s.jsx)("h2",{className:"font-semibold text-sm text-sf-text",children:"デザイン依頼一覧"})}),y?(0,s.jsx)("div",{className:"p-8 text-center text-sf-text-weak",children:"読み込み中..."}):0===M.length?(0,s.jsx)("div",{className:"p-8 text-center text-sf-text-weak",children:w||S||z||T?"検索結果が見つかりません":"デザイン依頼が見つかりません"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-xs text-sf-text-weak bg-gray-50 border-b border-sf-border",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium w-12"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"デザインNo."}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"得意先CD"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"得意先名"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"デザイン名"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"種別"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"進捗状況"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center font-medium",children:"活動回数"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left font-medium",children:"最終活動日"})]})}),(0,s.jsx)("tbody",{children:M.map(e=>{var r;let a,l=E.has(e.designNo),u=e.requests[e.requests.length-1];return(0,s.jsxs)(t.default.Fragment,{children:[(0,s.jsxs)("tr",{className:"border-b border-sf-border hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>{var s;let t;return s=e.designNo,void((t=new Set(E)).has(s)?t.delete(s):t.add(s),F(t))},children:[(0,s.jsx)("td",{className:"px-4 py-3",children:l?(0,s.jsx)(o,{size:16,className:"text-sf-light-blue"}):(0,s.jsx)(c.ChevronDown,{size:16,className:"text-gray-400"})}),(0,s.jsx)("td",{className:"px-4 py-3 font-medium text-sf-light-blue",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.designNo,(0,s.jsx)("button",{onClick:s=>_(e.designNo,s),className:"p-1 rounded hover:bg-sf-light-blue/10 text-pink-500 transition-colors",title:"関連画像を検索",children:(0,s.jsx)(g.Image,{size:16})})]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sf-text",children:e.customerCode}),(0,s.jsx)("td",{className:"px-4 py-3 text-sf-text font-medium",children:(0,s.jsx)(p.default,{href:`/customers/${e.customerCode}`,className:"text-sf-light-blue hover:underline",onClick:e=>e.stopPropagation(),children:e.customerName})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sf-text",children:e.designName||"-"}),(0,s.jsx)("td",{className:"px-4 py-3 text-sf-text-weak text-xs",children:e.designType||"-"}),(0,s.jsx)("td",{className:"px-4 py-3 text-center",children:(a=({完了:"bg-green-100 text-green-800",進行中:"bg-blue-100 text-blue-800",保留:"bg-yellow-100 text-yellow-800",未着手:"bg-gray-100 text-gray-800"})[r=e.designProgress]||"bg-gray-100 text-gray-800",r?(0,s.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${a}`,children:r}):null)}),(0,s.jsx)("td",{className:"px-4 py-3 text-center",children:(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.requests.length,"件"]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sf-text",children:u.日付})]},e.designNo),l&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:9,className:"bg-gray-50 p-0",children:(0,s.jsxs)("div",{className:"px-8 py-4",children:[(0,s.jsx)("div",{className:"mb-4 p-4 bg-white rounded border border-sf-border",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(x.Package,{size:16,className:"text-sf-light-blue mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-sf-text-weak",children:"デザイン名"}),(0,s.jsx)("p",{className:"text-sm font-medium text-sf-text",children:e.designName||"未設定"})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Layers,{size:16,className:"text-purple-600 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-sf-text-weak",children:"デザイン種別"}),(0,s.jsx)("p",{className:"text-sm font-medium text-sf-text",children:e.designType||"未設定"})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(h.TrendingUp,{size:16,className:"text-green-600 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-sf-text-weak",children:"進捗状況"}),(0,s.jsx)("p",{className:"text-sm font-medium text-sf-text",children:e.designProgress||"未設定"})]})]})]})}),(0,s.jsxs)("h3",{className:"text-sm font-semibold text-sf-text mb-3 flex items-center gap-2",children:[(0,s.jsx)(n.FileText,{size:16,className:"text-sf-light-blue"}),"活動履歴（時系列）"]}),(0,s.jsx)("div",{className:"space-y-3",children:e.requests.map((e,t)=>(0,s.jsx)("div",{className:"bg-white rounded border border-sf-border p-3 hover:shadow-sm transition-shadow",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)("div",{className:"flex-shrink-0 w-20 text-xs text-sf-text-weak",children:[(0,s.jsx)(i.Calendar,{size:14,className:"inline mr-1"}),e.日付]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-sf-light-blue",children:e.行動内容}),e.面談者&&(0,s.jsxs)("span",{className:"text-xs text-sf-text-weak flex items-center gap-1",children:[(0,s.jsx)(d.User,{size:12}),e.面談者]})]}),e.商談内容&&(0,s.jsx)("p",{className:"text-xs text-sf-text mt-1 leading-relaxed",children:e.商談内容}),e.提案物&&(0,s.jsxs)("div",{className:"mt-2 text-xs",children:[(0,s.jsx)("span",{className:"text-sf-text-weak",children:"提案物: "}),(0,s.jsx)("span",{className:"text-sf-text",children:e.提案物})]}),e.次回プラン&&(0,s.jsxs)("div",{className:"mt-1 text-xs",children:[(0,s.jsx)("span",{className:"text-sf-text-weak",children:"次回: "}),(0,s.jsx)("span",{className:"text-sf-text",children:e.次回プラン})]})]})]})},t))})]})})})]},e.designNo)})})]})})]}),K&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60] p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-sf-border flex justify-between items-center bg-gray-50 rounded-t-lg",children:[(0,s.jsxs)("h3",{className:"font-bold text-lg text-sf-text flex items-center gap-2",children:[(0,s.jsx)(l.Search,{size:20,className:"text-pink-500"}),'検索結果: "',X,'" (',B.length,"件)"]}),(0,s.jsx)("button",{onClick:()=>O(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-200 rounded-full p-1",children:(0,s.jsx)(f.X,{size:20})})]}),(0,s.jsx)("div",{className:"p-4 overflow-y-auto flex-1 bg-gray-100",children:B.length>0?(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:B.map((e,t)=>{let a=e.name.toLowerCase().endsWith(".pdf");return(0,s.jsxs)("div",{className:"group relative bg-white rounded border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[(0,s.jsx)("a",{href:(0,r.getImageUrl)(e.path),target:"_blank",rel:"noopener noreferrer",className:"block aspect-square overflow-hidden bg-gray-200 flex items-center justify-center",children:a?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-red-500",children:[(0,s.jsx)(n.FileText,{size:48}),(0,s.jsx)("span",{className:"text-xs font-bold mt-2 text-gray-500",children:"PDF"})]}):(0,s.jsx)("img",{src:(0,r.getImageUrl)(e.path),alt:e.name,className:"w-full h-full object-contain p-1 group-hover:scale-105 transition-transform duration-300",loading:"lazy"})}),(0,s.jsxs)("div",{className:"p-2 text-xs",children:[(0,s.jsx)("div",{className:"font-medium truncate text-sf-text",title:e.name,children:e.name}),(0,s.jsx)("div",{className:"text-gray-400 truncate mt-0.5",children:e.folder})]})]},t)})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[(0,s.jsx)(l.Search,{size:48,className:"mb-4 text-gray-300"}),(0,s.jsx)("p",{children:"画像が見つかりませんでした"})]})})]})})]})}e.s(["default",()=>b],98444)}]);